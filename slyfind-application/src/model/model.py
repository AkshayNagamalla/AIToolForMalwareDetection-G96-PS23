import pandas as pd
import pickle
import warnings
import sys


def model_find(name):
    warnings.filterwarnings("ignore")

    input_data = pd.read_csv(name)

    # Load the pickled ML model
    # Replace with the actual path to your pickled model
    model_path = "src/model/ps_rf_model_new.pkl"
    with open(model_path, 'rb') as model_file:
        model = pickle.load(model_file)

    # Load the pickled scaler
    # Replace with the actual path to your pickled scaler
    scaler_path = 'src/model/std_scaler_model.pkl'
    with open(scaler_path, 'rb') as scaler_file:
        scaler = pickle.load(scaler_file)

    # Extract the feature values from the DataFrame
    features = input_data.values  # Assuming the first column is not a feature

    # Reshape and scale the feature values
    reshaped_features = features.reshape(1, -1)
    scaled_features = scaler.transform(features)
    # print(scaled_features)
    # Make predictions using the loaded model
    prediction = model.predict_proba(scaled_features)

    # if prediction[0] == 0:
    #     print("Your system is not compromised")
    # elif prediction[0] == 1:
    #     print("Your system is compromised and Afflicting Malware is : Ransomware")
    # elif prediction[0] == 2:
    #     print("Your system is compromised and Afflicting Malware is : Spyware")
    # elif prediction[0] == 3:
    #     print("Your system is compromised and Afflicting Malware is : Trojan")
    prediction_dict = {
    "Begnign": prediction[0][0],
    "Ransomware": prediction[0][1],
    "Spyware": prediction[0][2],
    "Trojan": prediction[0][3]
    }
    print(prediction_dict)


if __name__ == "__main__":
    model_find(sys.argv[1])
